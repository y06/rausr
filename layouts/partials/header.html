<!DOCTYPE html>
<html lang="{{ .Site.LanguageCode }}">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="description" content="{{if .IsHome}}{{ $.Site.Params.description }}{{else}}{{.Description}}{{end}}" />
        <title>{{ .Title }} | rausr</title>

        {{ partial "opengraph.html" . }}
        
        {{ partial "favicon" . }}
        
        
        {{ partial "css" . }} {{ partial "js" . }} {{ hugo.Generator }}
        {{ with .OutputFormats.Get "RSS" }}
        <link href="{{ .RelPermalink }}" rel="alternate" type="{{ .MediaType.Type }}" title="{{ $.Site.Title }}" />
        <link href="{{ .RelPermalink }}" rel="feed" type="{{ .MediaType.Type }}" title="{{ $.Site.Title }}" />
        {{ end }}

        <!-- Cookie Consent orestbida load -->
        <link rel="preload" href="https://cdn.jsdelivr.net/gh/orestbida/cookieconsent@3.1.0/dist/cookieconsent.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
        <noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/orestbida/cookieconsent@3.1.0/dist/cookieconsent.css"></noscript>

        <!-- GLightbox load -->
        <link rel="preload" href="https://cdn.jsdelivr.net/npm/glightbox/dist/css/glightbox.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
        <noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/glightbox/dist/css/glightbox.min.css"></noscript>
        <script defer src="https://cdn.jsdelivr.net/npm/glightbox/dist/js/glightbox.min.js"></script>
        {{ $gtmID := or .Site.Params.gtmID .Site.Params.gtmId .Site.Params.googleTagManagerID }}
        {{ if $gtmID }}
        <!-- Google Tag Manager (analytics consent gated) -->
        <script type="text/plain" data-cookiecategory="analytics">
        (function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);})(window,document,'script','dataLayer','{{ $gtmID }}');
        </script>
        {{ end }}

        {{ if .Params.noindex }}
        <meta name="robots" content="noindex" /> 
        {{ end }}

    </head>

    <body>
        {{ partial "body-open" . }}

    <div class="container-fluid">

        <nav class="navbar navbar-expand-lg">
            
            <a class="navbar-brand" href="/"><img src="/svg/logo-solo.svg" width="80px" height="23px" alt=""></a>

            <div class="navbar-search" role="search">
                <form class="navbar-search__form" action="{{ "/search/" | relURL }}" method="get">
                    <label class="navbar-search__label" for="navbar-search-input">Search</label>
                    <input
                        id="navbar-search-input"
                        class="navbar-search__input"
                        type="search"
                        name="q"
                        placeholder="Search something"
                        autocomplete="off"
                        aria-autocomplete="list"
                        aria-controls="navbar-search-results"
                        aria-expanded="false"
                        data-index-path="{{ "/" | relURL }}index.json"
                    >
                    <button class="navbar-search__submit" type="submit" aria-label="Submit search">üîç</button>
                </form>
                <div class="navbar-search__dropdown" id="navbar-search-dropdown" hidden>
                    <ul class="navbar-search__results" id="navbar-search-results" role="listbox"></ul>
                    <a
                        id="navbar-search-see-all"
                        class="navbar-search__all"
                        href="{{ "/search/" | relURL }}"
                        data-search-base="{{ "/search/" | relURL }}"
                    >See all search results &rarr;</a>
                </div>
            </div>

            <button class="navbar-toggler" type="button" id="menuToggle" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                <img id="menuIcon" src="/svg/hamb.svg" alt="menu icon">
            </button>
            
            <div class="collapse navbar-collapse" id="navbarSupportedContent">
                {{ if .Site.Menus.main }}
                {{/* Compute cutoff for "this week" = last 7 days */}}
                {{ $weekCutoff := sub (now.Unix) (mul 7 86400) }}

                {{/* Articles this week: prefer Section "blog", fallback to Type "articles" */}}
                {{ $articlesPages := where $.Site.RegularPages "Section" "blog" }}
                {{ if eq (len $articlesPages) 0 }}
                  {{ $articlesPages = where $.Site.RegularPages "Type" "articles" }}
                {{ end }}
                {{ $articlesRecent := where $articlesPages "Date.Unix" "ge" $weekCutoff }}
                {{ $articlesCount := len $articlesRecent }}

                {{/* Works this week: prefer Section "works", fallback to Type "works" */}}
                {{ $worksPages := where $.Site.RegularPages "Section" "works" }}
                {{ if eq (len $worksPages) 0 }}
                  {{ $worksPages = where $.Site.RegularPages "Type" "works" }}
                {{ end }}
                {{ $worksRecent := where $worksPages "Date.Unix" "ge" $weekCutoff }}
                {{ $worksCount := len $worksRecent }}

                <ul class="navbar-nav">
                  {{ range sort .Site.Menus.main }}
                    {{ $id := lower .Identifier }}
                    {{ $name := lower .Name }}
                    {{ $isArticles := or (eq $id "articles") (eq $name "articles") (in .URL "/blog") }}
                    {{ $isWorks := or (eq $id "works") (eq $name "works") (in .URL "/works") }}
                    <li class="nav-item{{ if $isArticles }} nav-item--articles{{ end }}{{ if $isWorks }} nav-item--works{{ end }}">
                      <a href="{{ .URL }}">{{ .Name }}
                        {{ if and $isArticles (gt $articlesCount 0) }}
                          <span class="menu-badge menu-badge" aria-label="{{ $articlesCount }} articles this week">{{ $articlesCount }}</span>
                        {{ end }}
                        {{ if and $isWorks (gt $worksCount 0) }}
                          <span class="menu-badge menu-badge-works" aria-label="{{ $worksCount }} works this week">{{ $worksCount }}</span>
                        {{ end }}
                      </a>
                    </li>
                  {{ end }}
                </ul>
                {{ end }}

                {{ if .Site.Menus.icon }}
                <ul class="nav-socials">
                {{ range sort .Site.Menus.icon }}
                    <li class="nav-icon"><a href="{{ .URL }}" target="_blank"><i class="fab {{ .Name }}"></i></a></li>
                    {{ end }}
                </ul>
                {{ end }}                
            </div>
        </nav>

    </div>

<div id="page-blur">
