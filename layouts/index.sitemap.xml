{{- printf "<?xml version=\"1.0\" encoding=\"UTF-8\"?>" | safeHTML -}}
<urlset xmlns="http://www.sitemaps.org/schemas/sitemap/0.9">
  {{- range .Site.RegularPages -}}
    {{- if and (not .Draft) (not (.Params.robots_noindex | default false)) (ne .Section "drafts") (ne .Section "private") -}}
      {{- $last := .Lastmod | default .Date | default now -}}
      <url>
        <loc>{{ .Permalink }}</loc>
        <lastmod>{{ $last.UTC.Format "2006-01-02T15:04:05Z07:00" }}</lastmod>
        <changefreq>weekly</changefreq>
        <priority>0.50</priority>
      </url>
    {{- end -}}
  {{- end -}}
  {{- $site := .Site -}}
  {{- range $section := slice "blog" "works" -}}
    {{- $last := ($site.Lastmod | default now) -}}
    {{- with (where $site.RegularPages "Section" $section) -}}
      {{- with first 1 (sort . "Lastmod" "desc") -}}
        {{- $page := index . 0 -}}
        {{- $last = ($page.Lastmod | default $page.Date | default $last) -}}
      {{- end -}}
    {{- end -}}
    <url>
      <loc>{{ (printf "%s/" $section) | absURL }}</loc>
      <lastmod>{{ $last.UTC.Format "2006-01-02T15:04:05Z07:00" }}</lastmod>
      <changefreq>daily</changefreq>
      <priority>0.80</priority>
    </url>
  {{- end -}}
  <url>
    <loc>{{ .Site.BaseURL }}</loc>
    <lastmod>{{ (.Site.Lastmod | default now).UTC.Format "2006-01-02T15:04:05Z07:00" }}</lastmod>
    <changefreq>daily</changefreq>
    <priority>0.90</priority>
  </url>
</urlset>
