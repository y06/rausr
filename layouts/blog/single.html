{{ partial "header" . }}

<main>

    <section class="header header-article">
        <div class="header-content header-article">
            <h1>{{ .Title }}</h1>
            {{ with .Params.description }}
            <p>{{ . }}</p>
            {{ end }}
            {{ $authorName := default "rausr" .Params.author }}
            {{ $authorPhoto := default "/images/authors-pic-jakub.jpg" .Params.author_image }}
            {{ $bioLink := "" }}
            {{ if eq (lower $authorName) "jakub" }}
              {{ $bioLink = "/about/jakub-capliar/" }}
            {{ end }}
            <div class="header-meta">
              <button class="header-cta-button header-cta-button-contact header-cta-button-about header-meta__cta" data-scroll-target=".container-tag-list">Let‚Äôs read ‚Üì</button>
              <div class="card20-meta card20-meta--author header-meta__author">
                <span class="card20-meta__date">{{ .Date.Format "02.01.2006" }}</span>
                {{ if $bioLink }}
                  <a class="card20-meta__author-link" href="{{ $bioLink }}" aria-label="About {{ $authorName }}">
                    <span class="card20-meta__author">BY {{ $authorName }}</span>
                  </a>
                {{ else }}
                  <span class="card20-meta__author">BY {{ $authorName }}</span>
                {{ end }}
                {{ with $authorPhoto }}
                  {{ if $bioLink }}
                    <a class="card20-meta__photo-link" href="{{ $bioLink }}" aria-label="About {{ $authorName }}">
                      <img class="card20-meta__photo" src="{{ . }}" alt="Portrait of {{ $authorName }}" loading="lazy" decoding="async">
                    </a>
                  {{ else }}
                    <img class="card20-meta__photo" src="{{ . }}" alt="Portrait of {{ $authorName }}" loading="lazy" decoding="async">
                  {{ end }}
                {{ end }}
                
              </div>
            </div>
        </div>
        <div class="header-illustration header-image">
            {{ with .Params.header_image }}
            <img src="{{ . }}" alt="{{ $.Title }} header image" />
            {{ end }}
        </div>
    </section>


    <div class="container-tag-list">
        <button class="tag-scroll left">‚Üê</button>
        <div class="tag-list-wrapper">
            <ul class="tag-list">
                <li><a href="/blog/" class="tag-link">‚Üê Articles</a></li>
                {{ with index .Params.tags 0 }}
                    <li><a href="/topics/{{ urlize . }}" class="tag-link">‚Üê {{ partial "tag-label.html" . }}</a></li>
                {{ end }}
                <li><span class="tag-link active">{{ .Title }}</span></li>
            </ul>
        </div>
        <button class="tag-scroll right">‚Üí</button>
    </div>

</main>


<section class="article-container">
  <div class="article-left-column">
    <div class="article-left-column-top">
      {{ $re := `(?m)^## (.+)` }}
      {{ $matches := findRE $re .RawContent }}
      {{ if gt (len $matches) 0 }}
      <h2>{{ replaceRE `(?m)^## ` "" (index $matches 0) }}</h2>
      {{ end }}
    </div>
      <div class="content-section-column content-section-column-right">
      {{ $re := `(?m)^### (.+)` }}
      {{ $matches := findRE $re .RawContent }}
      {{ if gt (len $matches) 0 }}
        <div class="section-tags section-tags-article">
          {{ range $matches }}
            {{ $clean := replaceRE `(?m)^### ` "" . }}
            {{ $anchor := anchorize $clean }}
            <a class="tag" href="#{{ $anchor }}">{{ $clean }} ‚Üì</a>
          {{ end }}
        </div>
      {{ end }}
      {{ $re := `(?m)^## (.+)` }}
      {{ $matches := findRE $re .RawContent }}
      {{ if gt (len $matches) 0 }}
        {{ $firstH2 := index $matches 0 | replaceRE `(?m)^## ` "" }}
        {{ $h2anchor := printf "<h2 id=\"%s\">%s</h2>" (anchorize $firstH2) $firstH2 }}
        {{ $clean := replace .Content $h2anchor "" }}
        {{ $clean | safeHTML }}
      {{ else }}
        {{ .Content | safeHTML }}
      {{ end }}
      </div>

      <div class="content-section-column content-section-column-right">
        
      {{ with .Params.source }}
      <div class="section-tags"><div class="card20-meta card20-thanks">Sources:</div>
        {{ range . }}
          {{ $item := . }}
          {{ if hasPrefix (lower $item) "study" }}
            {{ $title := $item }}
            <span class="tag sources sources-study">üéì {{ $title }}</span>
          {{ else if hasPrefix (lower $item) "case" }}
            {{ $title := $item }}
            <span class="tag sources sources-case">üß™ {{ $title }}</span>
          {{ else if hasPrefix (lower $item) "book:" }}
            {{ $title := replaceRE `(?i)^book:\s*` "" $item }}
            <span class="tag sources sources-book">üìö {{ $title }}</span>
          {{ else if hasPrefix (lower $item) "interview:" }}
            {{ $title := replaceRE `(?i)^interview:\s*` "" $item }}
            <span class="tag sources sources-interview">üéôÔ∏è {{ $title }}</span>
          {{ else if hasPrefix (lower $item) "text:" }}
            {{ $title := replaceRE `(?i)^text:\s*` "" $item }}
            <span class="tag sources sources-text">üìì {{ $title }}</span>
          {{ else }}
            {{ $parsed := urls.Parse $item }}
            {{ $host := $item }}
            {{ if $parsed }}
              {{ $host = replace (replace $parsed.Host "www." "" ) ":" "" }}
            {{ end }}
            <a class="tag sources" href="{{ $item }}" target="_blank" rel="noopener noreferrer">{{ $host }}</a>
          {{ end }}
        {{ end }}
      </div>
      {{ end }}
    </div>

        <div class="card20-meta card20-thanks">
          {{ site.Params.blogThanksText }}
        </div>
  </div>

  <div class="article-right-column">
    <div class="article-right-cta-bottom">
          {{ partial "cta-articles.html" . }}
      <span>‚Üí</span>
    </div>
    <div class="article-right-featured">
      {{ partial "futured-articles.html" . }}
    </div>
  </div>

</section>


{{ partial "nextandprevious.html" . }}

{{ partial "subscribe.html" . }}

{{ partial "featured-content.html" . }}

{{ partial "cta-contact" . }}

{{ partial "footer" . }}
